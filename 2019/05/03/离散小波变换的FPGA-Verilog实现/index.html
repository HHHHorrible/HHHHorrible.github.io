<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="离散小波变换的FPGA-Verilog实现">
<meta name="keywords" content="FPGA ML">
<meta property="og:type" content="article">
<meta property="og:title" content="离散小波变换的FPGA-Verilog实现">
<meta property="og:url" content="https://blog.csdn.net/weixin_38071135/2019/05/03/离散小波变换的FPGA-Verilog实现/index.html">
<meta property="og:site_name" content="何伟宝的后花园">
<meta property="og:description" content="离散小波变换的FPGA-Verilog实现">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbc1a59a0e9.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbc2661fbd1.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbc41db84eb.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbda3ce7edf.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbdd6891faf.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbdff27e3e7.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbe0a709346.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbe0e862943.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbdd6891faf.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbe5229c73c.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbe6b37f7e4.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbecdd4c556.png">
<meta property="og:image" content="https://i.loli.net/2019/05/03/5ccbeeec0f4d0.jpg">
<meta property="og:updated_time" content="2019-10-12T07:57:07.253Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="离散小波变换的FPGA-Verilog实现">
<meta name="twitter:description" content="离散小波变换的FPGA-Verilog实现">
<meta name="twitter:image" content="https://i.loli.net/2019/05/03/5ccbc1a59a0e9.png">
  <link rel="canonical" href="https://blog.csdn.net/weixin_38071135/2019/05/03/离散小波变换的FPGA-Verilog实现/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>离散小波变换的FPGA-Verilog实现 | 何伟宝的后花园</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a379268dd5f327d467ed17a9a9be106b";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">何伟宝的后花园</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">今日你学左米啊</p>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
        
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
      
    
      
      
        
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      
    
  </ul>

    

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.csdn.net/weixin_38071135/2019/05/03/离散小波变换的FPGA-Verilog实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="He Wei Bao">
      <meta itemprop="description" content="认识到了自己的无知,才能真正认识世界">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="何伟宝的后花园">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            离散小波变换的FPGA-Verilog实现
            

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-05-03 15:56:43" itemprop="dateCreated datePublished" datetime="2019-05-03T15:56:43+08:00">2019-05-03</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-10-12 15:57:07" itemprop="dateModified" datetime="2019-10-12T15:57:07+08:00">2019-10-12</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FPGA-DSP/" itemprop="url" rel="index">
                    <span itemprop="name">FPGA DSP</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            <div class="post-description">离散小波变换的FPGA-Verilog实现</div>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="离散小波变换的FPGA-Verilog实现"><a href="#离散小波变换的FPGA-Verilog实现" class="headerlink" title="离散小波变换的FPGA-Verilog实现"></a>离散小波变换的FPGA-Verilog实现</h1><p>to 51研究不顺的假期</p>
<p>[toc]</p>
<p>在上一次的博客中我们介绍了短时傅里叶变换,小波函数,尺度函数,离散小波变换.详情请看:</p>
<p><a href="https://blog.csdn.net/weixin_38071135/article/details/83062330">小波变换(一)</a></p>
<p>这次我们把把整个变换说完,顺便介绍一下他的硬件实现(一维)</p>
<h2 id="尺度函数族"><a href="#尺度函数族" class="headerlink" title="尺度函数族"></a>尺度函数族</h2><p>众所周知,小波变换的双正交基就来自与小波函数和尺度函数,而他们通过scale和平移来得到的小波函数族和尺度函数族正正表示了不同小波(尺度)函数的分辨率,下面来用公式回顾一下:</p>
<h3 id="小波函数定义"><a href="#小波函数定义" class="headerlink" title="小波函数定义"></a>小波函数定义</h3><p>小波函数族$\psi_{j,k}(t)$定义为:<br>$$\psi_{j,k}(t) = 2^{j/2}\psi(2^jt-k);\quad j,k\in Z$$</p>
<h3 id="尺度函数定义"><a href="#尺度函数定义" class="headerlink" title="尺度函数定义"></a>尺度函数定义</h3><p>尺度函数族$\varphi_{j,k}(t)$定义为:<br>$$\varphi_{j,k}(t) = 2^{j/2}\varphi(2^jt-k);\quad j,k\in Z$$</p>
<h3 id="尺度函数分辨率沿拓"><a href="#尺度函数分辨率沿拓" class="headerlink" title="尺度函数分辨率沿拓"></a>尺度函数分辨率沿拓</h3><p>事实上,尺度函数族中的尺度 j 决定着不同的时间分辨率<br><img src="https://i.loli.net/2019/05/03/5ccbc1a59a0e9.png" alt="1"><br>而实际上(证明请看参考资料),高时间分辨率的尺度函数必然可以代表低时间分辨率的尺度函数,如上图的三角尺度函数可以表示为:<br><img src="https://i.loli.net/2019/05/03/5ccbc2661fbd1.png" alt="2"></p>
<h2 id="多分辨分析-MRA-方程"><a href="#多分辨分析-MRA-方程" class="headerlink" title="多分辨分析(MRA)方程"></a>多分辨分析(MRA)方程</h2><h3 id="尺度函数的MRA方程"><a href="#尺度函数的MRA方程" class="headerlink" title="尺度函数的MRA方程"></a>尺度函数的MRA方程</h3><p>有了上面的铺垫,这里就比较简单了,因为我们知道,低分辨率信号可以由高分辨率信号线性表达,所以我们可以看出,高分辨率信号所张成的空间必然包含低分辨率张成的空间:<br><img src="https://i.loli.net/2019/05/03/5ccbc41db84eb.png" alt="3"></p>
<p>图中越外围的代表越高分辨率的尺度函数,而$ L^2 $为平方可积空间,即:<br>$$ \int_{t\in R}|x(t)|^2 dt &lt; \infty $$<br>学过信号与系统的应该都知道积分式的定义吧…</p>
<p>所以在这个基础上我们引出<strong>尺度函数的多分辨分析方程</strong>(用以映射用高分辨率信号来表示低分辨率信号之间的关系)<br>$$<br>\varphi(t)=\sum_{k} h_{0}[k] \cdot \sqrt{2} \varphi(2 t-k)<br>$$<br>其中$h_0[k]$是尺度函数系数,也可以说成尺度滤波器的单位脉冲响应,到后面这个是重点.</p>
<h3 id="小波函数的MRA方程"><a href="#小波函数的MRA方程" class="headerlink" title="小波函数的MRA方程"></a>小波函数的MRA方程</h3><p>讲小波函数的MRA方程之前,我们不妨来回顾一下IDWT的定义:<br>$$x(t) = \sum_nc_0[k]\varphi_{0,k}(t) + \sum_nd_0[k]\psi_{0,k}(t)  + \sum_nd_1[k]\psi_{1,k}(t) +\cdots $$</p>
<p>我们可以看到上面的IDWT中,我们给定了小波函数$varphi_{0,k}(t) $的尺度$j=0$ ,以此为基底,再用不同分辨率的尺度函数来描述整个x(t).</p>
<p>实际上,我们可以重构上式:<br>$$x(t)=\sum_{k} c_{j_{0}, k} \varphi_{j_{0}, k}(t)+\sum_{j=j_{0}}^{\infty} \sum_{k} d_{j, k} \psi_{j, k}(t)$$</p>
<p>假设,此时他的信号空间由小波函数族张成的$V_{j_0}$和尺度函数族张成的$$W_{j_0}\oplus    W_{j_0 +1} \oplus W_{j_0 +2} \oplus W_{j_0+3} \oplus \cdots $$</p>
<p>则$L^2$空间可表示为:<br>$$ L^2  = V_{j_0} \oplus W_{j_0}\oplus    W_{j_0 +1} \oplus W_{j_0 +2} \oplus W_{j_0+3} \oplus \cdots $$</p>
<p>而事实上,小波函数和尺度函数满足一下关系:<br>$$<br>\begin{array}{l}{V_{1}=V_{0} \oplus W_{0}} \ {x_{1}(t)=C_{0}(t)+D_{0}(t)}\end{array}<br>$$</p>
<p>所以上上式中可以将$ V_{j_0}  $无限递归分解为小波信号张成的信号空间,即:<br>$$<br>\begin{array}{c}{L^{2}=\cdots \oplus W_{-2} \oplus W_{-1} \oplus W_{0} \oplus W_{1} \oplus W_{2} \oplus \cdots} \ {x(t)=\sum_{k} \sum_{j=-\infty}^{\infty} d_{j, k} \psi_{j, k}(t)}\end{array}<br>$$</p>
<p>所以从这个角度去考虑的话,我们就知道为什么$c_j [k]$表示的是信号的粗略(coarse)信息,而$ d_j [k] $ 表示的是信号的精细(detail)信息,当然,这只是其中一种理解,还有一种比较有意思的想法就是从差分的角度出发来考虑两种系数之间的意义,详见孙延奎教授的《小波分析及其应用》</p>
<p>结合尺度函数的MRA方程中的信号空间的图,我们可以看出,其实每一圈$V_j$所包含的就是低一维的尺度函数族张成的信号空间($V_{j-1}$)在加上低一维的小波函数张成的信号空间($W_{j-1}$),即:<br><img src="https://i.loli.net/2019/05/03/5ccbda3ce7edf.png" alt="4"></p>
<p>自然而然,我们可以知道小波函数的MRA方程的递归意义是更为重要的,所以有:<br>$$<br>\psi(t)=\sum_{k} h_{1}[k] \cdot \sqrt{2} \varphi(2 t-k)<br>$$<br>其中$ h_1[k] $称为小波函数系数</p>
<p>由于篇幅关系,这里没办法进一步讨论信号空间映射,小波函数系数和尺度函数系数的关系还有对称性,看情况会再作一篇博客讨论.</p>
<h3 id="离散小波变换的分解算法"><a href="#离散小波变换的分解算法" class="headerlink" title="离散小波变换的分解算法"></a>离散小波变换的分解算法</h3><p>有了MRA方程的概念,想必这里会比较简单,其实分解算法很简单,就是围绕着<br>$$<br>\begin{array}{l}{V_{1}=V_{0} \oplus W_{0}} \ {x_{1}(t)=C_{0}(t)+D_{0}(t)}\end{array}<br>$$<br>这个方程来进行分解,这里不给出证明过程(其实很简单,但是篇幅过长,详见参考资料),直接给出算法框图:<br>DWT的一级分解算法框图:<br><img src="https://i.loli.net/2019/05/03/5ccbdd6891faf.png" alt="5"></p>
<p>再将$C_j [k]$ 进行分解,可得DWT的二级分解算法框图:<br><img src="https://i.loli.net/2019/05/03/5ccbdff27e3e7.png" alt="6"><br>所以多级的大家也会求了吧…</p>
<p>可以简单地看出,信号经过小波函数系数(尺度函数系数)之后还需要经过一个抽取的过程,这个的话自己看看小波函数和尺度函数的定义式就可以了</p>
<h3 id="离散小波变换的重构算法"><a href="#离散小波变换的重构算法" class="headerlink" title="离散小波变换的重构算法"></a>离散小波变换的重构算法</h3><p>这里是相似的,而且由于懒的原因我没有做重构,所以也直接放图:<br><img src="https://i.loli.net/2019/05/03/5ccbe0a709346.png" alt="fff"><br><img src="https://i.loli.net/2019/05/03/5ccbe0e862943.png" alt="ffe"><br>可以简单地看出,信号经过小波函数系数(尺度函数系数)之后还需要经过一个内插的过程,这个的话自己看看小波函数和尺度函数的定义式就可以了.</p>
<p>需要注意的是,可以先抽取再滤波,但是不能先滤波后内插,见上图,(常识)</p>
<h2 id="小波变换-DWT-的FPGA实现"><a href="#小波变换-DWT-的FPGA实现" class="headerlink" title="小波变换(DWT)的FPGA实现"></a>小波变换(DWT)的FPGA实现</h2><p>总所周知,这次我们要实现的算法框图是这个:<br><img src="https://i.loli.net/2019/05/03/5ccbdd6891faf.png" alt="ffd"></p>
<h3 id="多相结构模型"><a href="#多相结构模型" class="headerlink" title="多相结构模型"></a>多相结构模型</h3><p>本来我是直接按照算法流程实现了DWT,然后讲抽取和滤波对调了位置(为了提高系统的性能)</p>
<p>后来从网上仅有的资料中查看到别人做了多相分解,后面我想了想,如果不用多相结构的话,相当于原信号的先经过了一次抽取,也是极大地浪费了信号.<br>又有:<br>$$ H_0(z) = H_{0e} (z^2) +z^{-1} H_{0o}(z^2)  $$<br>$$ H_1(z) = H_{1e} (z^2) +z^{-1} H_{1o}(z^2)  $$<br>所以我们将信号和滤波器系数都进行奇偶分解,分别进行滤波,得到整体FPGA框图:<br><img src="https://i.loli.net/2019/05/03/5ccbe5229c73c.png" alt="ffc"></p>
<p>接下来我们简单地理一下过程</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ol>
<li>激励和系数都是带符号位的,所有和信号流有关的reg和ip都要设置成signed</li>
<li>信号位宽是16,滤波器系数位宽是8</li>
<li>以db4小波为示例,其他小波只需要改改滤波器和matalb就可以了</li>
<li>仅实现一级分解,多级分解只要自己认真看博客就知道怎么做了</li>
</ol>
<h3 id="信号奇偶分解"><a href="#信号奇偶分解" class="headerlink" title="信号奇偶分解:"></a>信号奇偶分解:</h3><p>这个模块比较简单,但是想设计好需要一点小心思,思路就是做一个二分频时钟,上升沿将数据写入偶数部分,下降沿将数据写入奇数部分,还顺手设计了个三段式写法,确保建立时间和保持时间是信号保持时间的一半,但是都是FPGAer的常识了,这里不给出代码<br><img src="https://i.loli.net/2019/05/03/5ccbe6b37f7e4.png" alt="ffb"></p>
<h3 id="matlab获取滤波器系数"><a href="#matlab获取滤波器系数" class="headerlink" title="matlab获取滤波器系数"></a>matlab获取滤波器系数</h3><p>代码很简单,先生成,再量化:</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wn=<span class="string">'db4'</span>;</span><br><span class="line">[Ld,Hd,Lr,Hr] = wfilters(wn);</span><br><span class="line">k=<span class="number">0</span>:<span class="built_in">length</span>(Ld)<span class="number">-1</span>;</span><br><span class="line"> subplot(<span class="number">221</span>);stem(k,Ld);</span><br><span class="line"> title(<span class="string">'低通分解滤波器Ld'</span>);</span><br><span class="line"> subplot(<span class="number">222</span>);stem(k,Lr);</span><br><span class="line"> title(<span class="string">'低通重建滤波器Lr'</span>);</span><br><span class="line"> subplot(<span class="number">223</span>);stem(k,Hd);</span><br><span class="line"> title(<span class="string">'高通分解滤波器Hd'</span>);</span><br><span class="line"> subplot(<span class="number">224</span>);stem(k,Hd);</span><br><span class="line"> title(<span class="string">'高通重建滤波器Hr'</span>);</span><br><span class="line"></span><br><span class="line">qua_ld = <span class="built_in">round</span>(Ld*<span class="number">2</span>^<span class="number">8</span>);</span><br><span class="line">qua_hd = <span class="built_in">round</span>(Hd*<span class="number">2</span>^<span class="number">8</span>);</span><br><span class="line">qua_lr = <span class="built_in">round</span>(Lr*<span class="number">2</span>^<span class="number">8</span>);</span><br><span class="line">qua_hr = <span class="built_in">round</span>(Hr*<span class="number">2</span>^<span class="number">8</span>);</span><br><span class="line"><span class="built_in">disp</span>(qua_ld);</span><br><span class="line"><span class="built_in">disp</span>(qua_hd);</span><br><span class="line"><span class="built_in">disp</span>(qua_lr);</span><br><span class="line"><span class="built_in">disp</span>(qua_hr);</span><br></pre></td></tr></table></figure>

<h3 id="FPGA设计滤波器"><a href="#FPGA设计滤波器" class="headerlink" title="FPGA设计滤波器"></a>FPGA设计滤波器</h3><p>这里的流程跟我上一篇博客,<a href="https://blog.csdn.net/weixin_38071135/article/details/85086468">FPGA/Verilog 设计FIR滤波器</a>是相似的,这里不多说,给出一个滤波器的源码:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> filter_hd_e(</span><br><span class="line">	<span class="comment">//clock and reset</span></span><br><span class="line">	<span class="keyword">input</span> CLK_50M,RST_N,</span><br><span class="line">	<span class="comment">//filter in out</span></span><br><span class="line">	<span class="keyword">input</span>  <span class="keyword">signed</span> [<span class="number">15</span>:<span class="number">0</span>] data_in_hd_e,</span><br><span class="line">	<span class="keyword">output</span> <span class="keyword">signed</span> [<span class="number">19</span>:<span class="number">0</span>] hd_out_e</span><br><span class="line">);</span><br><span class="line"><span class="keyword">localparam</span> COEFF1,COEFF3,COEFF5,COEFF7;  <span class="comment">//过长省略</span></span><br><span class="line"><span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">19</span>:<span class="number">0</span>] add_result;</span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">15</span>:<span class="number">0</span>] data_shift[<span class="number">3</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">wire</span> <span class="keyword">signed</span> [<span class="number">23</span>:<span class="number">0</span>]  mul_data[<span class="number">3</span>:<span class="number">0</span>];	</span><br><span class="line"></span><br><span class="line"> add_final add_inst(</span><br><span class="line">	<span class="variable">.clock</span>       (CLK_50M),</span><br><span class="line">	<span class="variable">.data0x</span>      (mul_data[<span class="number">0</span>][<span class="number">23</span>:<span class="number">8</span>]),</span><br><span class="line">	<span class="variable">.data1x</span>      (mul_data[<span class="number">1</span>][<span class="number">23</span>:<span class="number">8</span>]),</span><br><span class="line">	<span class="variable">.data2x</span>      (mul_data[<span class="number">2</span>][<span class="number">23</span>:<span class="number">8</span>]),</span><br><span class="line">	<span class="variable">.data3x</span>      (mul_data[<span class="number">3</span>][<span class="number">23</span>:<span class="number">8</span>]),</span><br><span class="line">	<span class="variable">.result</span>      (add_result)</span><br><span class="line">);</span><br><span class="line"><span class="keyword">always</span> @ (<span class="keyword">posedge</span> CLK_50M <span class="keyword">or</span> <span class="keyword">negedge</span> RST_N)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span>(!RST_N)<span class="keyword">begin</span></span><br><span class="line">        data_shift[<span class="number">0</span>]  &lt;= <span class="number">0</span>;</span><br><span class="line">        data_shift[<span class="number">1</span>]  &lt;= <span class="number">0</span>;</span><br><span class="line">        data_shift[<span class="number">2</span>]  &lt;= <span class="number">0</span>;</span><br><span class="line">        data_shift[<span class="number">3</span>]  &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span> </span><br><span class="line">        data_shift[<span class="number">3</span>]  &lt;= data_shift[<span class="number">2</span>];</span><br><span class="line">        data_shift[<span class="number">2</span>]  &lt;= data_shift[<span class="number">1</span>];</span><br><span class="line">        data_shift[<span class="number">1</span>]  &lt;= data_shift[<span class="number">0</span>]; </span><br><span class="line">        data_shift[<span class="number">0</span>]  &lt;= data_in_hd_e;</span><br><span class="line">    <span class="keyword">end</span>                  </span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">mult	mult_inst_1 ( data_shift[<span class="number">0</span>] *COEFF1 <span class="comment">//下同</span></span><br><span class="line">mult	mult_inst_2 (</span><br><span class="line">mult	mult_inst_3 (</span><br><span class="line">mult	mult_inst_4 ( <span class="comment">//过长省略</span></span><br><span class="line"><span class="keyword">assign</span> hd_out_e = add_result;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure>

<p>大家对应这框图可能会说我怎么没有把滤波器系数给翻转,这个问题的话,大家可以看看那个获取系数的函数描述,他本来就帮我们翻转了.</p>
<p>加法器就算了,过于简单</p>
<h3 id="matlab产生激励"><a href="#matlab产生激励" class="headerlink" title="matlab产生激励"></a>matlab产生激励</h3><p>这个在上一篇博客中也有提及,但是这次我们不是直接产生mif文件,而是选择在仿真的时候读入数据,所以代码就是:</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">depth = <span class="number">1024</span>;</span><br><span class="line">width = <span class="number">16</span>;</span><br><span class="line">x = <span class="number">0</span> : <span class="number">2</span>*<span class="built_in">pi</span>/(depth<span class="number">-1</span>) :<span class="number">2</span>*<span class="built_in">pi</span>;</span><br><span class="line">y = <span class="built_in">sin</span>(x)+<span class="built_in">sin</span>(<span class="number">8</span>*x);</span><br><span class="line">y = (y/<span class="number">2</span>) * <span class="number">32768</span>;<span class="comment">%将信号放大32768倍</span></span><br><span class="line">y(360:400) = 32767;    //为了小波变换的戏剧性效果设置</span><br><span class="line">b = signed2unsigned(y,width);</span><br><span class="line">fid = fopen(<span class="string">'sinx.txt'</span>,<span class="string">'wt'</span>); <span class="comment">%将信号写入一个.txt文件中</span></span><br><span class="line"><span class="keyword">for</span> num=<span class="number">0</span> : (depth<span class="number">-1</span>) </span><br><span class="line">fprintf(fid,<span class="string">'%x\n'</span>,<span class="built_in">round</span>(b(num+<span class="number">1</span>)));</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fclose(fid);</span><br></pre></td></tr></table></figure>

<h3 id="仿真结果"><a href="#仿真结果" class="headerlink" title="仿真结果"></a>仿真结果</h3><p>用tb读入数据:</p>
<figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">integer</span> i;   <span class="comment">//数组坐标</span></span><br><span class="line"><span class="keyword">reg</span> <span class="keyword">signed</span> [<span class="number">15</span>:<span class="number">0</span>] stimulus[<span class="number">1</span>:data_num];  <span class="comment">//数组形式存储读出的数据</span></span><br><span class="line"><span class="keyword">initial</span> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    RST_N = <span class="number">1'b1</span>;</span><br><span class="line">	#<span class="number">60</span> RST_N = <span class="number">1'b0</span>;</span><br><span class="line">	#<span class="number">60</span> RST_N = <span class="number">1'b1</span>; </span><br><span class="line">    <span class="built_in">$readmemh</span>(<span class="string">"sinx.txt"</span>, stimulus);  <span class="comment">//将txt文件中的数据存储在数组中</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">repeat</span>(data_num) <span class="keyword">begin</span>   <span class="comment">//重复读取数组中的数据</span></span><br><span class="line">        i = i + <span class="number">1</span>;</span><br><span class="line">        data_in = stimulus[i]; </span><br><span class="line">        #PERIOD;         <span class="comment">//每个时钟读取一次</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">	 <span class="built_in">$stop</span>;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>那么又到了紧张刺激的,看波形环节:<br>matlab计算:<br><img src="https://i.loli.net/2019/05/03/5ccbecdd4c556.png" alt="ff"></p>
<p>fpga计算:<br><img src="https://i.loli.net/2019/05/03/5ccbeeec0f4d0.jpg" alt><br>误差大概率来源于字长效应…</p>
<p>想要具体源码的可以联系/私信本人</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://zhuanlan.zhihu.com/p/22450818" target="_blank" rel="noopener">形象易懂讲解算法I——小波变换</a><br><a href="https://zhuanlan.zhihu.com/p/44215123" target="_blank" rel="noopener">小波变换完美通俗讲解系列之 （一）</a><br><a href="https://zhuanlan.zhihu.com/p/44217268" target="_blank" rel="noopener">小波变换完美通俗讲解系列之 （二   </a><br><a href="https://en.wikipedia.org/wiki/Discrete_wavelet_transform" target="_blank" rel="noopener">Wavelet transform - Wikipedia</a><br><a href="disp.ee.ntu.edu.tw/tutorial/WaveletTutorial.pdf">A Tutorial of the Wavelet Transform</a></p>
<hr>
<p>Ruch, David K. And Van Fleet, Patrick J.《Wavelet Theory：An elementary Approach With Applications》</p>
<p>孙延奎 .《小波分析及其应用》</p>
<p>罗高涌 . <a href="https://www.amazon.cn/dp/B00LHRN5P2/ref=sr_1_1?ie=UTF8&qid=1539596083" target="_blank" rel="noopener">Wavelets in Engineering Applications </a></p>
<p>陈后金.《数字信号处理》<br>视频教程:<a href="http://www.icourse163.org/course/NJTU-1001950001" target="_blank" rel="noopener">中国大学mooc-数字信号处理</a></p>
<p><a href="https://blog.csdn.net/weixin_38071135/article/details/83039402">如果你觉得有丶收获的话</a></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/03/17/ZigBee协议简介-一/" rel="next" title="ZigBee协议简介(一)">
                  <i class="fa fa-chevron-left"></i> ZigBee协议简介(一)
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/05/09/数字锁相环的FPGA实现-一/" rel="prev" title=" 数字锁相环的FPGA实现(一)">
                   数字锁相环的FPGA实现(一) <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#离散小波变换的FPGA-Verilog实现"><span class="nav-number">1.</span> <span class="nav-text">离散小波变换的FPGA-Verilog实现</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#尺度函数族"><span class="nav-number">1.1.</span> <span class="nav-text">尺度函数族</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#小波函数定义"><span class="nav-number">1.1.1.</span> <span class="nav-text">小波函数定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#尺度函数定义"><span class="nav-number">1.1.2.</span> <span class="nav-text">尺度函数定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#尺度函数分辨率沿拓"><span class="nav-number">1.1.3.</span> <span class="nav-text">尺度函数分辨率沿拓</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#多分辨分析-MRA-方程"><span class="nav-number">1.2.</span> <span class="nav-text">多分辨分析(MRA)方程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#尺度函数的MRA方程"><span class="nav-number">1.2.1.</span> <span class="nav-text">尺度函数的MRA方程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#小波函数的MRA方程"><span class="nav-number">1.2.2.</span> <span class="nav-text">小波函数的MRA方程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#离散小波变换的分解算法"><span class="nav-number">1.2.3.</span> <span class="nav-text">离散小波变换的分解算法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#离散小波变换的重构算法"><span class="nav-number">1.2.4.</span> <span class="nav-text">离散小波变换的重构算法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#小波变换-DWT-的FPGA实现"><span class="nav-number">1.3.</span> <span class="nav-text">小波变换(DWT)的FPGA实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#多相结构模型"><span class="nav-number">1.3.1.</span> <span class="nav-text">多相结构模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#注意事项"><span class="nav-number">1.3.2.</span> <span class="nav-text">注意事项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#信号奇偶分解"><span class="nav-number">1.3.3.</span> <span class="nav-text">信号奇偶分解:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#matlab获取滤波器系数"><span class="nav-number">1.3.4.</span> <span class="nav-text">matlab获取滤波器系数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FPGA设计滤波器"><span class="nav-number">1.3.5.</span> <span class="nav-text">FPGA设计滤波器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#matlab产生激励"><span class="nav-number">1.3.6.</span> <span class="nav-text">matlab产生激励</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#仿真结果"><span class="nav-number">1.3.7.</span> <span class="nav-text">仿真结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.4.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">He Wei Bao</p>
  <div class="site-description" itemprop="description">认识到了自己的无知,才能真正认识世界</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/HHHHorrible" title="GitHub &rarr; https://github.com/HHHHorrible" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/weixin_38071135" title="https://blog.csdn.net/weixin_38071135">CSDN</a>
        </li>
      
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">He Wei Bao</span>
</div>
  <span class="post-meta-divider">|</span>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共70.6k字</span>
</div>
<span id="busuanzi_container_site_pv" style='display:none'>
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
</span>

<span id="busuanzi_container_site_uv" style='display:none'>
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
</span>

        












        
      </div>
    </footer>
  </div>

  
    
  
  <script color='0,0,0' opacity='0.7' zIndex='-1' count='199' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.1"></script><script src="/js/motion.js?v=7.4.1"></script>
<script src="/js/schemes/muse.js?v=7.4.1"></script>

<script src="/js/next-boot.js?v=7.4.1"></script>



  





















  

  
    
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  

</body>
</html>
